<html lang="es-ES">
<head>
  <meta charset="utf-8">
  <title>Canvas of Life</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <style type="text/css">
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      overflow: hidden;
    }

    #screen {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      background-color: #000;
    }
  </style>
  <script type="text/javascript">
    (function() {
      "use strict";

      // requestAnimationFrame compat.
      // var requestAnimationFrame = window.requestAnimationFrame ||
      //   window.mozRequestAnimationFrame    ||
      //   window.webkitRequestAnimationFrame ||
      //   window.msRequestAnimationFrame;
      // window.requestAnimationFrame = requestAnimationFrame;

      // bind() compat.
      // if (!Function.prototype.bind) {
      //   Function.prototype.bind = function (oThis) {
      //     if (typeof this !== "function") {
      //       // closest thing possible to the ECMAScript 5 internal IsCallable function
      //       throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
      //     }

      //     var aArgs = Array.prototype.slice.call(arguments, 1),
      //         fToBind = this,
      //         fNOP = function () {},
      //         fBound = function () {
      //           return fToBind.apply(this instanceof fNOP && oThis
      //                                  ? this
      //                                  : oThis,
      //                                aArgs.concat(Array.prototype.slice.call(arguments)));
      //         };

      //     fNOP.prototype = this.prototype;
      //     fBound.prototype = new fNOP();

      //     return fBound;
      //   };
      // }

      var _merge = function(dst, src) {
        for(var prop in src) dst[prop] = src[prop];
        return dst;
      }

      var Cell = function(canvas) {
        this.selector = canvas;
        this.canvas   = document.getElementById(this.selector);
        this.ctx      = this.canvas.getContext('2d');
        this.ctx.lineWidth = 1;

        var options   = _merge({x: 0, y: 0, size: 80, alive: false}, arguments[1] || {});

        this.x        = options.x;
        this.y        = options.y;
        this.size     = options.size;
        this.alive    = options.alive;
      }

      Cell.prototype.draw = function() {
        this.ctx.fillStyle = 'rgba(90,90,90,1)';

        this.ctx.fillRect(this.x, this.y, this.size, this.size);
        this.ctx.clearRect(this.x+1, this.y+1, this.size-1, this.size-1);

        if ( this.alive ) {
          this.ctx.fillStyle = 'rgba(234, 10, 10,1)';
          this.ctx.fillRect(this.x+1, this.y+1, this.size-1, this.size-1);
        }

        return this;
      }

      Cell.prototype.live = function() {
        this.alive = true;
        this.draw();

        return this;
      }

      Cell.prototype.die = function() {
        this.alive = false;
        this.draw();

        return this;
      }

      Cell.prototype.toggle = function() {
        if ( this.alive ) this.die();
        else this.live();
      }

      Cell.prototype.inside = function(x, y) {
        return (this.x <= x && (this.x+this.size) >= x && this.y <= y && (this.y + this.size) >= y);
      }

      var Board = function(canvas) {
        this.selector = canvas;

        // cache canvas object & context
        this.canvas   = document.getElementById(this.selector);
        this.ctx      = this.canvas.getContext('2d');

        // default options
        this.options  = _merge({
          columns: 12,
          rows: 8,
          cellSize: 80
        }, arguments[1] || {});

        // poor living creatures
        this.cells    = [];

        // current dimensions (in pixels)
        this.width  = this.options.columns * this.options.cellSize;
        this.height = this.options.rows * this.options.cellSize;

        // set canvas size
        this.canvas.width = this.width;
        this.canvas.height = this.height;

        this.draw();

        this.attachEventListeners();
        // this.resize();
      }

      Board.prototype.resize = function(e) {
        var body = document.getElementsByTagName('body')[0];
        var rect = body.getBoundingClientRect();

        if ( this.canvas.width === rect.width && this.canvas.height === rect.height )
          return this;

        this.canvas.width   = rect.width;
        this.canvas.height  = rect.height;

        this.draw();

        return this;
      }

      // Board.prototype.resize = function(e) {
      //   var body = document.getElementsByTagName('body')[0];
      //   var rect = body.getBoundingClientRect();

      //   var w = this.canvas.width, h = this.canvas.height,
      //     nw = rect.width, nh = rect.height;

      //   if ( w === nw && h === nh ) return this;

      //   var rw = nw / w, rh = nh / h;
      //   this.ctx.scale(rw, rh);


      //   return this;
      // }


      Board.prototype.click = function(e) {
        var x = e.clientX, y = e.clientY;

        var cell = this.findCellAt(x, y);
        if ( cell ) cell.toggle();

        return false;
      }

      Board.prototype.findCellAt = function(x, y) {
        var target = this.cells.filter(function(cell) { return cell.inside(x, y); });

        if ( target.length === 0 )
          return null;

        return target[0];
      }

      Board.prototype.attachEventListeners = function() {
        // respond on user clicks
        this.canvas.addEventListener('click', this.click.bind(this));

        // resize board on window size change
        window.addEventListener('resize', this.resize.bind(this));

        return this;
      }

      Board.prototype.draw = function() {
        this.build();
        this.cells.forEach(function(cell) { cell.draw(); });
      }

      Board.prototype.build = function() {
        var cellSize = parseInt(this.options.cellSize);

        this.cells.length = 0;

        for(var y=-cellSize, my=this.canvas.height+cellSize; y < my; y += cellSize)
          for(var x=-cellSize, mx=this.canvas.width+cellSize; x < mx; x += cellSize)
            this.cells.push(new Cell(this.selector, {x: x, y: y, size: cellSize, alive: false}));
      }

      document.addEventListener('DOMContentLoaded', function() {
        window.Board = new Board('screen');
      });
    })();
  </script>
</head>
<body>
  <canvas id="screen" width="600" height="400"></canvas>
</body>
</html>
